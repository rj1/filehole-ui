<!DOCTYPE html>
<html>
<head>
<title>filehole.org</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
      body {
        background-color: #1a1c1d;
        color: #fff;
        font-family: sans-serif;
        font-size: 14px;
        padding: 20px;
        text-align: center;
      }

      h1 {
        font-size: 32px;
        margin-bottom: 20px;
      }

      #hole {
        display: flex;
        align-items: center;
        background-color: #000;
        box-shadow: 0 0 50px 10px rgba(0, 0, 0, 0.5) inset;
        text-transform: uppercase;
        border-radius: 50%;
        cursor: pointer;
        margin: 0 auto;
        max-width: 200px;
        min-height: 200px;
        padding: 20px;
        text-align: center;
        transition: border-color 0.3s ease-in-out;
        margin-bottom: 30px;
        border: 10px solid rgba(0, 0, 0, 0.5);
      }

      #hole:hover {
        border-color: #ccc;
      }

      #filelist {
        list-style: none;
        margin: 0 auto;
        max-width: 600px;
        padding: 0;
      }

      .file {
        border-radius: 5px;
        background-color: #333;
        border: 1px solid #555;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 5px 0;
        padding: 10px;
        transition: all 0.3s ease-in-out;
      }

      .file:hover {
        background-color: #444;
        box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.3);
      }

      .file a {
        color: #fff;
        margin-right: 10px;
        text-decoration: none;
      }

      .file a:hover {
        text-decoration: underline;
      }

      .file button {
        background-color: transparent;
        border: none;
        color: #fff;
        cursor: pointer;
        font-size: 18px;
        margin-left: 10px;
        margin-right: -7px;
        padding: 0;
        transition: opacity 0.3s ease-in-out;
      }

      .file button:hover {
        opacity: 0.7;
      }

      button {
        background-color: transparent;
        border: 2px solid #3e4446;
        border-radius: 5px;
        color: #fff;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
        padding: 7px 20px;
        text-transform: uppercase;
        transition: background-color 0.3s ease-in-out;
      }

      button:hover {
        background-color: #444;
        border-color: #fff;
      }

      #options {
        align-items: center;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
      }

      .option {
        background-color: #222;
        border: 2px solid #444;
        border-radius: 5px;
        color: #fff;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
        padding: 7px 20px;
        transition: all 0.3s ease-in-out;
      }

      .option:hover {
        background-color: #444;
        border-color: #fff;
      }

      #options label {
        font-size: 16px;
        margin-right: 10px;
      }

      #options input[type="number"],
      #options select[name="expiry_time"] {
        background-color: #333;
        border: none;
        border-radius: 5px;
        color: #fff;
        font-size: 16px;
        height: 30px;
        margin-right: 10px;
        padding: 0 10px;
        text-align: center;
        transition: all 0.3s ease-in-out;
        width: 80px;
      }

      #options input[type="number"]:hover,
      #options select[name="expiry_time"]:hover {
        background-color: #444;
        cursor: pointer;
      }

      #options input[type="number"]:focus,
      #options select[name="expiry_time"]:focus {
        background-color: #444;
        outline: none;
      }

      @media (max-width: 768px) {
        body {
          font-size: 12px;
          padding: 10px;
        }

        h1 {
          font-size: 24px;
          margin-bottom: 10px;
        }

        #hole {
          max-width: 150px;
          min-height: 150px;
          padding: 10px;
          margin-bottom: 20px;
        }

        #filelist {
          max-width: 400px;
        }

        .file {
          border-radius: 5px;
          padding: 8px;
          margin: 3px 0;
        }

        .file a {
          font-size: 12px;
          margin-right: 5px;
        }

        .file button {
          font-size: 14px;
          margin-left: 5px;
          margin-right: -3px;
        }

        button {
          font-size: 14px;
          margin-top: 5px;
          padding: 5px 12px;
        }

        #options {
          margin-top: 10px;
        }

        #options label {
          font-size: 14px;
          margin-right: 5px;
        }

        #options input[type="number"],
        #options select[name="expiry_time"] {
          font-size: 14px;
          height: 25px;
          margin-right: 5px;
          padding: 0 5px;
          width: 80px;
        }
      }
    </style>
</head>
<body>
<h1>filehole</h1>
<div id="hole">drop your files into the hole or give it a click</div>
<ul id="filelist"></ul>
<button id="clear">clear files</button>
<button id="upload" disabled>upload files</button>
<div id="options">
<label for="url_length">url length:</label>
<input id="url_length" name="url_length" type="number" value="5" min="5" max="64" />
<label for="expiry_time">expiry time:</label>
<select id="expiry_time" name="expiry_time">
<option value="3600">1 hour</option>
<option value="18000">5 hours</option>
<option value="86400" selected>1 day</option>
<option value="140400">39 hours</option>
<option value="172800">2 days</option>
<option value="248400">69 hours</option>
<option value="432000">5 days</option>
</select>
</div>
<script>
      const hole = document.getElementById("hole");
      const filelist = document.getElementById("filelist");
      const clearButton = document.getElementById("clear");
      const uploadButton = document.getElementById("upload");
      const urlLength = document.getElementById("url_length");
      const expiryTime = document.getElementById("expiry_time");

      let files = [];

      // drag n drop
      hole.addEventListener("dragover", (e) => {
        e.preventDefault();
        hole.style.borderColor = "#ccc";
      });

      hole.addEventListener("dragleave", () => {
        hole.style.borderColor = "#444";
      });

      hole.addEventListener("drop", (e) => {
        e.preventDefault();
        hole.style.borderColor = "#444";
        const newFiles = Array.from(e.dataTransfer.files);
        addFiles(newFiles);
        updateButtons();
      });

      // handle file input
      hole.addEventListener("click", () => {
        const input = document.createElement("input");
        input.type = "file";
        input.multiple = "true";
        input.accept = "*";
        input.style.display = "none";
        input.addEventListener("change", (e) => {
          const newFiles = Array.from(e.target.files);
          addFiles(newFiles);
          updateButtons();
        });
        document.body.appendChild(input);
        input.click();
        document.body.removeChild(input);
      });

      // display selected files + update files array
      const addFiles = (newFiles) => {
        newFiles.forEach((file) => {
          const listItem = document.createElement("li");
          listItem.classList.add("file");

          const fileName = document.createElement("span");
          fileName.textContent = file.name;
          listItem.appendChild(fileName);

          const fileSize = document.createElement("span");
          let sizeInBytes = file.size;

          if (sizeInBytes < 1024) {
            fileSize.textContent = sizeInBytes + " bytes";
          } else if (sizeInBytes < 1024 * 1024) {
            fileSize.textContent = (sizeInBytes / 1024).toFixed(2) + " KB";
          } else if (sizeInBytes < 1024 * 1024 * 1024) {
            fileSize.textContent = (sizeInBytes / (1024 * 1024)).toFixed(2) + " MB";
          } else {
            fileSize.textContent = (sizeInBytes / (1024 * 1024 * 1024)).toFixed(2) + " GB";
          }

          listItem.appendChild(fileSize);

          const removeButton = document.createElement("button");
          removeButton.textContent = "X";
          removeButton.addEventListener("click", () => {
            files.splice(files.indexOf(file), 1);
            filelist.removeChild(listItem);
            updateButtons();
          });
          listItem.appendChild(removeButton);

          filelist.appendChild(listItem);
          files.push(file);
        });
      };

      // update upload and clear buttons depending on state of files array
      const updateButtons = () => {
        if (files.length > 0) {
          uploadButton.disabled = false;
          clearButton.disabled = false;
        } else {
          uploadButton.disabled = true;
          clearButton.disabled = true;
        }
      };

      // clear all files from interface
      clearButton.addEventListener("click", () => {
        files = [];
        filelist.innerHTML = "";
        updateButtons();
      });

      // declare variables for progress indicator
      const dots = document.createElement("span");
      dots.textContent = ".";
      let dotCount = 0;

      // upload files
      uploadButton.addEventListener("click", () => {
        const urlLengthValue = urlLength.value;
        const expiryTimeValue = expiryTime.value;
        let currentIndex = 0;

        const updateItemStatus = (index, message) => {
          const listItem = filelist.children[index];
          const statusElement = listItem.children[2];
          statusElement.textContent = message;
        };

        const uploadFile = () => {
          // check if all files are uploaded
          if (currentIndex >= files.length) {
            // all files uploaded
            files = [];
            return;
          }

          const file = files[currentIndex];
          const formData = new FormData();
          formData.append("file", file);
          formData.append("url_len", urlLengthValue);
          formData.append("expiry", expiryTimeValue);

          updateItemStatus(currentIndex, "uploading...");

          fetch("https://filehole.org/", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.text())
            .then((data) => {
              data = data.trim();
              const url = document.createElement("a");
              url.href = data;
              url.target = "_blank";
              url.textContent = data;

              const listItem = filelist.children[currentIndex];
              const removeButton = listItem.children[2];
              listItem.replaceChild(url, removeButton);

              const copyButton = document.createElement("button");
              copyButton.textContent = "copy to clipboard";
              copyButton.addEventListener("click", (event) => {
                event.stopPropagation();
                navigator.clipboard.writeText(data);
              });

              listItem.appendChild(copyButton);

              // remove current file from the formdata object to upload the next file
              formData.delete("file");

              // increment the current index and upload the next file
              currentIndex++;
              uploadFile();
            })
            .catch((error) => {
              console.error(error);
              updateItemStatus(currentIndex, "upload failed");
              // error handling here
            });
        };

        // start uploading the first file
        uploadFile();
      });
    </script>
</body>
</html>
